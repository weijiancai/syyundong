var cfg = null;
if (!window.iyuesai_config) {
    cfg = {};
} else {
    cfg = window.iyuesai_config;
}
var _iyuesai = function () {
    this.version = "1.0.0";
    this.date = "2014-10-11 14:59";
    this.server = cfg;
    delete cfg;
};
_iyuesai.prototype = {
    serverTime: "", selector: function (b, a) {
        return $('[data-selector="' + b + '"]', a);
    }, getWebSitePath: function () {
        return this.server.websitePath;
    }, webSitePath: function (a) {
        return !!a ? ((typeof(this.server.websitePath) == "undefined" ? "" : this.server.websitePath) + a) : null;
    }, getImageServer: function () {
        return this.server.imageServer;
    }, imageServer: function (a) {
        return !!a ? ((typeof(this.server.imageServer) == "undefined" ? "" : this.server.imageServer) + a) : null;
    }, getContentServer: function () {
        return this.server.contentServer;
    }, contentServer: function (a) {
        return !!a ? ((typeof(this.server.contentServer) == "undefined" ? "" : this.server.contentServer) + a) : null;
    }, getPassportServer: function () {
        return this.server.passportServer;
    }, passportServer: function (a) {
        return !!a ? ((typeof(this.server.passportServer) == "undefined" ? "" : this.server.passportServer) + a) : null;
    }
};
_iyuesai.prototype.ui = {
    timer: null, lightMessageBox: function (d) {
        var c = this;
        c.clearTimer();
        var b = {content: "", type: "success", timer: 3000}, e = $("#light-message-box");
        $.extend(b, d);
        if (e.length > 0) {
            e.stop(true, true).remove();
        }
        e = $("<div>", {id: "light-message-box"});
        var a = $("<i>", {"class": "icon-msg icon-msg-" + b.type}), f = $("<span>").html(b.content);
        $([a, f]).appendTo(e);
        e.appendTo($("body"));
        e.css({
            "margin-left": -(e.outerWidth() / 2) + "px",
            "margin-top": (e.outerHeight() / 2) + "px"
        }).animate({bottom: "show", opacity: "show"}, 200, function () {
            c.timer = setTimeout(function () {
                e.animate({bottom: "hide", opacity: "hide"}, 200, function () {
                    e.remove();
                });
            }, b.timer);
        });
    }, clearTimer: function () {
        clearTimeout(this.timer);
        this.timer = null;
    }, textareaAutoHeight: function (b, c, a) {
        return (function (f) {
            var d = parseInt(f.css("height")), e = $("<pre>").css({
                position: "absolute",
                "z-index": "-10",
                left: "-9999px",
                top: "auto",
                padding: (parseInt(f.css("line-height")) / 2) + "px 0",
                "font-size": f.css("font-size"),
                "line-height": f.css("line-height"),
                width: f.css("width"),
                "font-family": f.css("font-family"),
                "white-space": f.css("white-space"),
                "word-wrap": f.css("word-wrap"),
                "font-weight": f.css("font-weight")
            });
            f.bind("keyup keypress", function () {
                if (!f.data("auto-height")) {
                    e.insertAfter(f);
                }
                e.html(iyuesai.util.encodeHTML(f.val()));
                setTimeout(function () {
                    if (e.outerHeight() > d) {
                        f.stop(true, true).animate({height: e.outerHeight() + "px"}, 200);
                        !!c && c.call(this, e, d);
                    } else {
                        f.stop(true, true).animate({height: d + "px"}, 200);
                        !!a && a.call(this, e, d);
                    }
                }, 50);
            }).trigger("keyup");
        })(b);
    }
};
_iyuesai.prototype.util = {
    setCookie: function (b, e, a, c) {
        var d = new Date();
        d.setDate(d.getDate() + a);
        document.cookie = b + "=" + escape(e) + ((a == null) ? "" : ";path=/;" + (!!c ? "domain=" + c + ";" : "") + "expires=" + d.toGMTString());
    }, getCookie: function (b) {
        var a = document.cookie.match(new RegExp("(^| )" + b + "=([^;]*)(;|$)"));
        if (a != null) {
            return unescape(a[2]);
        }
        return null;
    }, delCookie: function (a, b) {
        iyuesai.util.setCookie(a, "", -1, b);
    }, checkIndex: function () {
        if (window.location.href.indexOf(iyuesai.webSitePath("/index")) == -1) {
            if (window.location.href.indexOf(iyuesai.webSitePath("/site/index")) == -1) {
                window.location.href = iyuesai.webSitePath("/index");
                return;
            }
        }
        window.location.reload();
    }, replaceImageName: function (c, e, b) {
        var d = /(_\d*x\d*)|(_\d*x)/, a = ((typeof b == "undefined") ? true : b);
        if (c.match(/(_\d_\d\.)/)) {
            return a ? c.replace(/(_\d_\d\.)/, "_2_" + e + ".") : c.replace(/(_\d\.)/, "_" + e + ".");
        }
        return a ? c.replace(/(\d_\d*x\d*)|(\d_\d*x)/, "2_" + e) : c.replace(d, "_" + e);
    }, encodeHTML: function (a) {
        return a.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#39;");
    }, encodeDangerHTML: function (a) {
        return a.replace(/<style[^>]*>[\s\S]*?<\/[^>]*style>/g, "").replace(/<script[^>]*>[\s\S]*?<\/[^>]*script>/g, "").replace(/<iframe[^>]*>[\s\S]*?<\/[^>]*iframe>/g, "");
    }, getEscapeTime: function (b, d) {
        b = isNaN(Number(b)) ? ((b)).getTime() : Number(b);
        var c = parseInt((iyuesai.api.getServerTime() - b) / 1000), a = (new Date(b)).format(d || "yyyy-MM-dd HH:mm:ss");
        if (c < 10) {
            a = "刚刚";
        } else {
            if (c >= 10 && c < 60) {
                a = c + "秒前";
            } else {
                if (c >= 60 && c < 3600) {
                    a = parseInt(c / 60) + "分钟前";
                } else {
                    if (c >= 3600 && c < 86400) {
                        a = parseInt(c / 3600) + "小时前";
                    } else {
                        if (c >= 86400 && c < 2592000) {
                            a = parseInt(c / 86400) + "天前";
                        } else {
                            a = (new Date(b)).format(d || "yyyy-MM-dd HH:mm:ss");
                        }
                    }
                }
            }
        }
        return a;
    }, blinkTitle: {
        show: function () {
            var b = 0, a = document.title;
            var c = setInterval(function () {
                b++;
                if (b == 3) {
                    b = 1;
                }
                if (b == 1) {
                    document.title = "【　　　】" + a;
                }
                if (b == 2) {
                    document.title = "【新消息】" + a;
                }
            }, 500);
            return [c, a];
        }, clear: function (a) {
            if (a) {
                clearInterval(a[0]);
                document.title = a[1];
            }
        }
    }, formatNumber: function (b) {
        b = "" + b;
        if (/[^0-9\.]/.test(b)) {
            return "invalid value";
        }
        b = b.replace(/^(\d*)$/, "$1.");
        b = (b).replace(/(\d*\.\d\d)\d*/, "$1");
        b = b.replace(".", ",");
        var a = /(\d)(\d{3},)/;
        while (a.test(b)) {
            b = b.replace(a, "$1,$2");
        }
        b = b.replace(/,(\d\d)$/, ".$1");
        return b.replace(/^\./, "0.").replace(/\,$/, "");
    }
};
_iyuesai.prototype.api = {
    praise: function (e, cfg) {
        var option = {
            label: "span",
            color: "red",
            "font-size": "2em",
            callback: null,
            text: "+1",
            icon: "i",
            "class": "icon20-praised"
        };
        var isPraised = e.find(option.icon).hasClass(option["class"]) ? true : false;
        if (!isPraised) {
            cfg && $.extend(option, cfg);
            $.ajax({
                url: e.data("url"),
                type: "post",
                dataType: "json",
                data: (e.data("params") ? eval("(" + e.data("params") + ")") : {}),
                cache: false,
                success: function (data) {
                    if (data.flag == 1) {
                        var $i = $("<b>", {"class": "animate-praise"}).text(option.text), num = e.find(option.label);
                        var x = e.offset().left, y = e.offset().top;
                        $i.css({top: (y - e.outerHeight()), left: (x + e.outerWidth() / 2), color: option.color});
                        $("body").append($i);
                        $i.animate({top: y - 100, opacity: 0, "font-size": option["font-size"]}, 1000, function () {
                            $i.remove();
                        });
                        num.text((parseInt(num.text()) + 1));
                        e.find(option.icon).addClass(option["class"]);
                        e.unbind("click");
                        option.callback && option.callback.call(e);
                    } else {
                        if (data.flag == 302) {
                            window.location.href = iyuesai.webSitePath(data.url);
                        } else {
                            iyuesai.ui.lightMessageBox({type: "error", content: data.msg || "请求失败，请重试！"});
                        }
                    }
                },
                error: function () {
                    iyuesai.ui.lightMessageBox({type: "error", content: "网络错误，请重试！"});
                }
            });
        }
    }, comment: function (a) {
        var b = {
            label: "span",
            color: "red",
            "font-size": "2em",
            callback: null,
            text: "+1",
            icon: "i",
            form: null,
            commentTarget: null
        };
        a && $.extend(b, a);
        if (b.form) {
            var c = b.form;
            $.ajax({
                url: c.attr("action"),
                type: c.attr("method"),
                dataType: "json",
                data: c.serializeArray(),
                cache: false,
                success: function (g) {
                    if (g.flag == 1) {
                        if (b.commentTarget) {
                            var h = b.commentTarget, k = $("<b>", {"class": "animate-praise"}).text(b.text), f = h.find(b.label);
                            var d = h.offset().left, j = h.offset().top;
                            k.css({top: (j - h.outerHeight()), left: (d + h.outerWidth() / 2), color: b.color});
                            $("body").append(k);
                            k.animate({top: j - 100, opacity: 0, "font-size": b["font-size"]}, 1000, function () {
                                k.remove();
                            });
                            f.text((parseInt(f.text()) + 1));
                        }
                        iyuesai.ui.lightMessageBox({content: g.msg || "评论成功！"});
                        b.callback && b.callback.call(c);
                    } else {
                        if (g.flag == 302) {
                            window.location.href = iyuesai.webSitePath(g.url);
                        } else {
                            iyuesai.ui.lightMessageBox({type: "error", content: g.msg || "请求失败，请重试！"});
                        }
                    }
                },
                error: function () {
                    iyuesai.ui.lightMessageBox({type: "error", content: "网络错误，请重试！"});
                }
            });
        } else {
            console.log("'form' parameter not found");
        }
    }, collect: function (e, cfg) {
        var option = {
            label: "em",
            color: "red",
            "font-size": "2em",
            callback: null,
            text: "+1",
            icon: "i",
            "class": "icon-faved"
        };
        var isPraised = e.find(option.icon).hasClass(option["class"]) ? true : false;
        if (!isPraised) {
            cfg && $.extend(option, cfg);
            $.ajax({
                url: iyuesai.webSitePath(e.data("url")),
                type: "post",
                dataType: "json",
                data: (e.data("params") ? eval("(" + e.data("params") + ")") : {}),
                cache: false,
                success: function (data) {
                    if (data.flag == 1) {
                        var $i = $("<b>", {"class": "animate-praise"}).text(option.text), num = e.find(option.label);
                        var x = e.offset().left, y = e.offset().top;
                        $i.css({top: (y - e.outerHeight()), left: (x + e.outerWidth() / 2), color: option.color});
                        $("body").append($i);
                        $i.animate({top: y - 100, opacity: 0, "font-size": option["font-size"]}, 1000, function () {
                            $i.remove();
                        });
                        num.text((parseInt(num.text()) + 1));
                        e.find(option.icon).addClass(option["class"]);
                        e.unbind("click");
                        option.callback && option.callback.call(e);
                    } else {
                        if (data.flag == 302) {
                            window.location.href = iyuesai.webSitePath(data.url);
                        } else {
                            iyuesai.ui.lightMessageBox({type: "error", content: data.msg || "请求失败，请重试！"});
                        }
                    }
                },
                error: function () {
                    iyuesai.ui.lightMessageBox({type: "error", content: "网络错误，请重试！"});
                }
            });
        }
    }, follow: function (d, b) {
        var c = {
            text: "关注",
            followText: "取消关注",
            addClass: "btn-danger",
            url: iyuesai.webSitePath("/game/follow"),
            params: {gameId: d.data("gameid")}
        };
        b && $.extend(c, b);
        var a = function (e) {
            if (iyuesai.api.isLogin(true)) {
                $.ajax({
                    url: c.url,
                    type: "post",
                    dataType: "json",
                    data: $.extend(c.params, {action: e, passport: iyuesai.util.getCookie("passport")}),
                    cache: false,
                    success: function (f) {
                        if (f.flag == 1) {
                            if (e == 1) {
                                d.text(c.followText).removeClass(c.addClass);
                                d.data("followed", "1");
                            } else {
                                d.text(c.text).addClass(c.addClass);
                                d.data("followed", null);
                            }
                        } else {
                            if (f.flag == 302) {
                                window.location.href = iyuesai.webSitePath("/auth/login?url=" + window.encodeURIComponent(window.location.href));
                            } else {
                                f.msg && iyuesai.ui.lightMessageBox({type: "error", content: f.msg});
                            }
                        }
                    },
                    error: function () {
                        iyuesai.ui.lightMessageBox({type: "error", content: "网络错误，请重试！"});
                    }
                });
            }
        };
        if (d.data("followed") && d.data("followed") == "1") {
            a(2);
        } else {
            a(1);
        }
    }, join: function (b) {
        var a = $(b).data("activityid");
        $.ajax({
            url: iyuesai.webSitePath("/activity/signup/") + a, success: function (c) {
                if (c.flag == 1) {
                    NodeTpl.get("activity-join", {data: c.data}, function (d) {
                        $.dialog({id: "joinWrap", title: "我要参加", content: d, padding: "0px"}).showModal();
                    });
                } else {
                    if (c.flag == 2) {
                        $.ajax({
                            cache: false,
                            type: "POST",
                            url: iyuesai.webSitePath("/activity/signup/"),
                            data: {formId: c.data.id, activityId: c.data.activityId},
                            error: function (d) {
                                $.dialog.error("网络错误。请稍后重试");
                            },
                            success: function (d) {
                                if (d.flag == 1) {
                                    iyuesai.ui.lightMessageBox({content: "报名成功！"});
                                } else {
                                    if (d.flag == 302) {
                                        window.location.href = iyuesai.webSitePath(d.url);
                                    } else {
                                        if (d.msg) {
                                            switch (d.msg) {
                                                case"register_activity_already":
                                                    $.dialog.error("您已报名该活动");
                                                    break;
                                                case"register_activity_wait":
                                                    $.dialog.error("报名尚未开始，敬请期待");
                                                    break;
                                                case"register_activity_over":
                                                    $.dialog.error("报名已经结束");
                                                    break;
                                                case"register_activity_exceed":
                                                    $.dialog.error("很抱歉，已经到达报名人数上限，您还可以关注其他活动");
                                                    break;
                                                default:
                                                    $.dialog.error(d.msg);
                                                    break;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    } else {
                        if (c.flag == 302) {
                            window.location.href = iyuesai.webSitePath(c.url);
                        } else {
                            if (c.msg) {
                                switch (c.msg) {
                                    case"register_activity_already":
                                        $.dialog.error("您已报名该活动");
                                        break;
                                    case"register_activity_wait":
                                        $.dialog.error("报名尚未开始，敬请期待");
                                        break;
                                    case"register_activity_over":
                                        $.dialog.error("报名已经结束");
                                        break;
                                    case"register_activity_exceed":
                                        $.dialog.error("很抱歉，已经到达报名人数上限，您还可以关注其他活动");
                                        break;
                                    default:
                                        $.dialog.error(c.msg);
                                        break;
                                }
                            }
                        }
                    }
                }
            }
        });
    }, imageViewer: function (f, a) {
        var c = {
            parentDom: ".topic-img-wrap",
            currentDom: "a",
            dataIndex: "index",
            dataPhoto: "photo",
            dataUserUrl: "userurl",
            dataNickName: "nickname",
            dataLarge: "large",
            dataUrl: "url"
        };
        if (!!a) {
            $.extend(c, a);
        }
        var d = f.closest(c.parentDom).find(c.currentDom);
        var b = $.dialog({
            id: "imgViewer",
            content: '<div class="module-loading" style="width:300px;height:150px;"></div>',
            padding: 0,
            title: '<a href="' + f.data(c.dataUserUrl) + '" target="_blank"><img src="' + (f.data(c.dataPhoto).indexOf("http:") != -1 ? f.data(c.dataPhoto) : iyuesai.imageServer(f.data(c.dataPhoto))) + '" style="width:25px;height:25px;border-radius:50%;-webkit-border-radius:50%;-moz-border-radius:50%;"/></a> <a href="' + f.data(c.dataUserUrl) + '" style="color:#F5A623;" target="_blank">' + f.data(c.dataNickName) + "</a> 分享的图片" + (d.length > 1 ? '&nbsp;&nbsp;<span class="muted" id="imageViewerCount" style="font-weight:normal;">1/' + d.length + "</span>" : "")
        }).showModal();
        NodeTpl.get("image-viewer", {
            dialog: b,
            index: f.data(c.dataIndex),
            dataLarge: c.dataLarge,
            dataUrl: c.dataUrl,
            imgList: d
        }, function (e) {
            b.content(e).reset();
        });
    }, tplQueueLoad: function (a, c) {
        var a = a || [];
        for (var b = 0; b < a.length; b++) {
            var d = a[b];
            (function (f) {
                if (f.url) {
                    $.ajax({
                        url: f.url, type: "get", dataType: "json", cache: false, success: function (h) {
                            if (h.flag == 1) {
                                var g = {element: c(f.selector), data: h.data};
                                if (f.data) {
                                    g = $.extend(f.data, g);
                                }
                                NodeTpl.get(f.tpl, g, function (j) {
                                    c(f.selector).html(j);
                                });
                            }
                        }
                    });
                } else {
                    var e = {element: c(f.selector)};
                    if (f.data) {
                        e = $.extend(f.data, e);
                    }
                    NodeTpl.get(f.tpl, e, function (g) {
                        c(f.selector).html(g);
                    });
                }
            })(d);
        }
    }, deleteComment: function (a) {
        var b = {
            msg: "确定要删除该评论吗？",
            success: null,
            error: null,
            replyId: "",
            action: iyuesai.webSitePath("/userCenter/DeleteUserReply?replyId=")
        };
        a && $.extend(b, a);
        $.dialog.confirm(b.msg, function () {
            $.ajax({
                url: (b.action + b.replyId), type: "get", dataType: "json", cache: false, success: function (c) {
                    if (c.flag == 1) {
                        iyuesai.ui.lightMessageBox({content: "删除成功！"});
                        (!!b.success) && (b.success.call(window, c));
                    } else {
                        if (c.flag == 302) {
                            window.location.href = iyuesai.webSitePath(c.url);
                        } else {
                            iyuesai.ui.lightMessageBox({type: "error", content: "删除失败，请重试！"});
                            (!!b.error) && (b.error.call(window, c));
                        }
                    }
                }, error: function () {
                    iyuesai.ui.lightMessageBox({type: "error", content: "网络错误，请稍后重试！"});
                    (!!b.error) && (b.error.call(window));
                }
            });
        });
    }, deleteTopic: function (a) {
        var b = {
            msg: "确定要删除该话题吗？",
            success: null,
            error: null,
            topicId: "",
            action: iyuesai.webSitePath("/userCenter/DeleteUserTopic?topicId=")
        };
        a && $.extend(b, a);
        $.dialog.confirm(b.msg, function () {
            $.ajax({
                url: (b.action + b.topicId), type: "get", dataType: "json", cache: false, success: function (c) {
                    if (c.flag == 1) {
                        iyuesai.ui.lightMessageBox({content: "删除成功！"});
                        (!!b.success) && (b.success.call(window, c));
                    } else {
                        if (c.flag == 302) {
                            window.location.href = iyuesai.webSitePath(c.url);
                        } else {
                            iyuesai.ui.lightMessageBox({type: "error", content: "删除失败，请重试！"});
                            (!!b.error) && (b.error.call(window, c));
                        }
                    }
                }, error: function () {
                    iyuesai.ui.lightMessageBox({type: "error", content: "网络错误，请稍后重试！"});
                    (!!b.error) && (b.error.call(window));
                }
            });
        });
    }, getUserData: function (c, b) {
        var a = iyuesai.util.getCookie("passport");
        if (a) {
            $.ajax({
                url: iyuesai.contentServer("GetUserData"),
                dataType: "json",
                data: {passport: a, loginType: "default", _t: new Date().getTime()},
                type: "GET",
                success: function (e) {
                    if (e && e.code == 200) {
                        c && c.call(window, e.messages.data);
                    } else {
                        c && c.call(window, null);
                    }
                },
                error: function () {
                    c && c.call(window, null);
                }
            });
        }
    }, getUserInfo: function (a) {
        if (iyuesai.util.getCookie("passport")) {
            $.ajax({
                url: iyuesai.passportServer("getProfile.do"),
                dataType: "jsonp",
                cache: false,
                data: {passport: iyuesai.util.getCookie("passport"), loginType: "default"},
                success: function (b) {
                    if (b && b.code == 200) {
                        userData = b.messages.data.user;
                        a && a.call(window, userData);
                    } else {
                        a && a.call(window, null);
                    }
                },
                error: function () {
                    a && a.call(window, null);
                }
            });
        } else {
            a && a.call(window, null);
        }
    }, getUnreadMsg: function (a) {
        if (iyuesai.util.getCookie("passport")) {
            $.ajax({
                url: iyuesai.webSitePath("/userCenter/message/statistics"),
                dataType: "json",
                cache: false,
                data: {passport: iyuesai.util.getCookie("passport"), loginType: "default"},
                success: function (c) {
                    if (c && c.flag == 1) {
                        var b = c.data;
                        a && a.call(window, b);
                    } else {
                        a && a.call(window, null);
                    }
                },
                error: function (b) {
                    a && a.call(window, null);
                }
            });
        } else {
            a && a.call(window, null);
        }
    }, getServerTime: function () {
        var a = function () {
            $("[data-timestamp]", $("body")).each(function () {
                $(this).text(iyuesai.util.getEscapeTime($(this).data("timestamp")));
            });
        };
        var b = function (c) {
            $.ajax({
                url: iyuesai.webSitePath("/api/GetAdvertisement?position=" + (new Date()).getTime()),
                dataType: "json",
                async: false,
                cache: false,
                success: function (e) {
                    $(window).one("focus", function () {
                        b(function () {
                            a();
                        });
                    });
                    iyuesai.serverTime = ZM.Date.parse(e.messages.serverTime).getTime();
                    !!c && c.call(window);
                }
            });
        };
        if (!iyuesai.serverTime) {
            b(function () {
                setInterval(function () {
                    iyuesai.serverTime += 1000;
                }, 1000);
                setInterval(function () {
                    a();
                }, 5000);
            });
        }
        return iyuesai.serverTime;
    }, writeShareModule: function (a, c) {
        var b = [{webid: "qzone", title: "qq空间", appkey: "zDey5D5hxEaececk"}, {
            webid: "tsina",
            title: "新浪微博",
            appkey: "1868074881"
        }];
        var d = c || "";
        (!!a.pic) && (a.pic = a.pic.split("?")[0].replace(/(\d_\d*x\d*)|(\d_\d*x)/, "0_0"));
        $(b).each(function (f, g) {
            b[f] = '<a href="http://www.jiathis.com/send/?webid=' + g.webid + "&url=http://" + (window.location.host + (a.url || "")) + "&pic=" + (a.pic || "") + "&title=" + (a.title || "") + "&appkey=" + (g.appkey || "") + "&summary=" + (a.summary || $('meta[name="Description"]').attr("content")) + '" target="_blank" class="shareto' + d + " shareto" + d + "-" + g.webid + '" title="分享到' + g.title + '"></a>';
        });
        document.write(b.join(""));
    }, setSearchEnginesParams: function (e, f) {
        var b = $("form#searchEnginesForm"), a = [], d = [];
        for (var c in e) {
            a.push('[name="' + c + '"]');
            d.push($("<input>", {type: "hidden", name: c, value: e[c]}));
        }
        $(a.join(","), b).remove();
        $(d).appendTo(b);
        if (f) {
            setTimeout(function () {
                f.call(b);
            }, 20);
        }
    }, isLogin: function (a) {
        if (iyuesai.util.getCookie("passport")) {
            return true;
        } else {
            a && (window.location.href = iyuesai.webSitePath("/auth/login?url=" + window.encodeURIComponent(window.location.href)));
            return false;
        }
    }, dynamicForm: {
        getNormalRules: function (e, d, g, c) {
            var b = null;
            if (!!e && !!d) {
                b = [];
                b.push("'" + d + "'");
                if (!!g) {
                    var f = [];
                    for (var a in g) {
                        f.push("'" + a + "':'" + ((typeof g[a] == "string") ? g[a].replace(new RegExp(/\\/gi), "\\\\") : g[a]) + "'");
                    }
                    b.push("{" + f.join(",") + "}");
                }
                if (!!e[c]) {
                    b.push("'" + e[c] + "'");
                }
                b = "[" + b.join(",") + "]";
            }
            return b;
        }, getRules: function (f) {
            var g = [], d = null;
            var a = null, b = [];
            (!!f.required) && (b.push("['required']"));
            var c = {
                intege: "^-?[1-9]\\d*$",
                intege1: "^[1-9]\\d*$",
                intege2: "^-[1-9]\\d*$",
                num: "^([+-]?)\\d*\\.?\\d+$",
                num1: "^[1-9]\\d*|0$",
                num2: "^-[1-9]\\d*|0$",
                decmal: "^([+-]?)\\d*\\.\\d+$",
                decmal1: "^[1-9]\\d*.\\d*|0.\\d*[1-9]\\d*$",
                decmal2: "^-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*)$",
                decmal3: "^-?([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0)$",
                decmal4: "^[1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0$",
                decmal5: "^(-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*))|0?.0+|0$",
                email: "^[_\\.0-9a-z-]+@([0-9a-z][0-9a-z-]+\\.){1,4}[a-z]{2,3}$",
                color: "^[a-fA-F0-9]{6}$",
                url: "^http[s]?:\\/\\/([\\w-]+\\.)+[\\w-]+([\\w-./?%&=]*)?$",
                chinese: "^[\\u4E00-\\u9FA5\\uF900-\\uFA2D]+$",
                ascii: "^[\\x00-\\xFF]+$",
                zipcode: "^\\d{6}$",
                mobile: "^(13|14|15|17|18)[0-9]{9}$",
                ip4: "^(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)$",
                notempty: "^\\S+$",
                picture: "(.*)\\.(jpg|bmp|gif|ico|pcx|jpeg|tif|png|raw|tga)$",
                rar: "(.*)\\.(rar|zip|7zip|tgz)$",
                date: "^\\d{4}(\\-|\\/|.)\\d{1,2}\\1\\d{1,2}$",
                qq: "^[1-9]*[1-9][0-9]*$",
                tel: "^(([0\\+]\\d{2,3}-)?(0\\d{2,3})-)?(\\d{7,8})(-(\\d{3,}))?$",
                username: "^\\w+$",
                letter: "^[A-Za-z]+$",
                letter_u: "^[A-Z]+$",
                letter_l: "^[a-z]+$",
                idcard: "^[1-9]([0-9]{14}|[0-9]{17})$",
                money: "^[0-9]+([.]\\d{1,2})?$"
            };
            if (!!f.texttype) {
                switch (f.texttype) {
                    case"regex":
                        d = iyuesai.api.dynamicForm.getNormalRules(f, "pattern", {regex: f.regex}, "msg");
                        if (!!d) {
                            g.push(d);
                        }
                        if (!!f.compareto) {
                            d = iyuesai.api.dynamicForm.getNormalRules(f, "equalto", {name: f.compareto}, "comparemsg");
                            if (!!d) {
                                g.push(d);
                            }
                        }
                        break;
                    default:
                        d = iyuesai.api.dynamicForm.getNormalRules(f, "pattern", {regex: c[f.texttype]}, "msg");
                        if (!!d) {
                            g.push(d);
                        }
                        if (!!f.compareto) {
                            d = iyuesai.api.dynamicForm.getNormalRules(f, "equalto", {name: f.compareto}, "comparemsg");
                            if (!!d) {
                                g.push(d);
                            }
                        }
                        break;
                }
            }
            if (!!f.type) {
                switch (f.type) {
                    case"textarea":
                        if (!!f.max) {
                            d = iyuesai.api.dynamicForm.getNormalRules(f, "length", {max: f.max}, "msg");
                            if (!!d) {
                                g.push(d);
                            }
                        }
                        break;
                }
            }
            if (b.length > 0 || g.length > 0) {
                a = "[" + (b.concat(g)).join(",") + "]";
            }
            return a;
        }, getDynamicDom: function (f, d, b) {
            var c;
            if (d.hasOwnProperty("value") && d.value) {
                b.defaultValue.push({name: d.id, value: d.value});
            }
            if (f.type == "0" || f.type == (d.validategrp || "0") || !d.validategrp || (d.validategrp || "0") == "0") {
                c = "";
                switch (d.type) {
                    case"text":
                        c = '<input type="' + d.type + '" class="span4"';
                        (!!d.code) && (c += ' data-code="' + d.code + '"');
                        c += ' name="' + d.id + '" title="' + (d.tip || "") + '" validate-title="' + d.content + '" validate-rules="' + (iyuesai.api.dynamicForm.getRules(d) || "[]") + '"/>';
                        break;
                    case"password":
                        c = '<input type="' + d.type + '" class="span4"';
                        (!!d.code) && (c += ' data-code="' + d.code + '"');
                        c += ' name="' + d.id + '" title="' + (d.tip || "") + '" validate-title="' + d.content + '" validate-rules="' + (iyuesai.api.dynamicForm.getRules(d) || "[]") + '" />';
                        break;
                    case"dropdown":
                        c = '<select class="span4"';
                        (!!d.code) && (c += ' data-code="' + d.code + '"');
                        c += ' name="' + d.id + '">';
                        $(d.options).each(function (e, g) {
                            c += '<option value="' + g.id + '"';
                            if (!!g.checked) {
                                c += ' selected="selected"';
                            }
                            c += ">" + g.text + "</option>";
                        });
                        c += "</select>";
                        break;
                    case"radiobtngrp":
                        $(d.options).each(function (e, g) {
                            c += '<label class="radio inline"><input type="radio" name="' + d.id + '" value="' + g.id + '"';
                            (!!d.code) && (c += ' data-code="' + d.code + '"');
                            if (!!g.checked) {
                                c += ' checked="checked"';
                            } else {
                                if (e == 0) {
                                    c += ' checked="checked"';
                                }
                            }
                            c += "/><span>" + g.text + "</span></label>";
                        });
                        break;
                    case"checkboxgrp":
                        c = '<span validate-name="' + d.id + '" validate-title="' + d.content + '" validate-rules="' + (iyuesai.api.dynamicForm.getRules(d) || "[]") + '" validate-group="checkbox">';
                        $(d.options).each(function (e, g) {
                            c += '<label class="checkbox inline"><input type="checkbox" name="' + d.id + '" value="' + g.id + '"';
                            (!!d.code) && (c += ' data-code="' + d.code + '"');
                            if (!!g.checked) {
                                c += ' checked="checked"';
                            }
                            c += "/><span>" + g.text + "</span></label>";
                        });
                        c += "</span>";
                        break;
                    case"date":
                        var a = {};
                        a.s = "datePickerSelector" + i;
                        (!!d.min) && (a.min = d.min);
                        (!!d.max) && (a.max = d.max);
                        b.datePickerList.push(a);
                        c = '<div class="input-prepend">';
                        c += '<input type="text" data-selector="datePickerSelector' + i + '" name="' + d.id + '" readonly="readonly"';
                        (!!d.code) && (c += ' data-code="' + d.code + '"');
                        c += ' validate-title="' + d.content + '" validate-rules="' + (iyuesai.api.dynamicForm.getRules(d) || "[]") + '" />';
                        c += '<span class="add-on"><i class="icon-calendar" style="margin-top:0px;"></i></span>';
                        c += "</div>";
                        break;
                    case"textarea":
                        c = '<textarea rows="5" validate-title="' + d.content + '" validate-rules="' + (iyuesai.api.dynamicForm.getRules(d) || "[]") + '" name="' + d.id + '"';
                        (!!d.code) && (c += ' data-code="' + d.code + '"');
                        if (d.max) {
                            c += ' max-length="' + d.max + '"';
                        }
                        c += "></textarea>";
                        break;
                    case"area":
                        var a = {};
                        a.s = "areaFiller" + i;
                        a.level = d.arealevel || 1;
                        b.defineList.push("match-position");
                        b.areaFillerList.push(a);
                        c = '<input type="hidden" name="' + d.id + '" />';
                        c += '<div data-selector="' + a.s + '"></div>';
                        break;
                    case"table":
                        var a = {};
                        a.s = "tableFiller" + i;
                        a.header = d.header;
                        b.tableFillerList.push(a);
                        c = {};
                        c.type = "table";
                        c.content = '<td colspan="2">';
                        c.content += '<table data-selector="' + a.s + '" class="table-module">';
                        c.content += "<caption>";
                        (!!d.required) && (c.content += '<span class="help-required">*</span>');
                        c.content += d.content;
                        c.content += '<input type="hidden" name="' + d.id + '" validate-title="' + d.content + '" validate-rules="' + (iyuesai.api.dynamicForm.getRules(d) || "[]") + '"/>';
                        c.content += "</caption>";
                        c.content += "<thead>";
                        c.content += "<tr>";
                        if (!!d.header) {
                            $(d.header).each(function (g, e) {
                                c.content += ("<th>" + e + "</th>");
                            });
                        }
                        c.content += '<th width="60">操作</th>';
                        c.content += "</tr>";
                        c.content += "</thead>";
                        c.content += "<tbody>";
                        c.content += "<tr>";
                        $(d.header).each(function (g, e) {
                            c.content += ('<td><input type="text" title="' + e + '" value=""></td>');
                        });
                        c.content += '<td class="text-center"><a href="javascript:;" class="table-button" title="确定" data-selector="confirmData"><i class="icon-ok-sign"></i></a><a href="javascript:;" class="table-button" title="删除" data-selector="removeData"><i class="icon-trash"></i></a>';
                        c.content += "</td>";
                        c.content += "</tr>";
                        c.content += "</tbody>";
                        c.content += "<tfoot><tr>";
                        c.content += '<td class="text-right" colspan="' + (d.header.length + 1) + '">';
                        c.content += '<button type="button" data-selector="addTableData" class="btn btn-warning">' + (d.addtext || ("添加" + d.content)) + "</button>";
                        c.content += "</tr></tfoot>";
                        break;
                }
            }
            return c;
        }
    }
};
var iyuesai = null;
window.iyuesai = new _iyuesai();
define(["jquery", "core", "artdialog", "gotop"], function () {
    $(function () {
        iyuesai.api.tplQueueLoad([{tpl: "header-head", selector: "headerHead"}, {
            tpl: "header-adv",
            selector: "headerAdv"
        }], function (c) {
            return iyuesai.selector(c, $("body"));
        });
        $(document).delegate("div#light-message-box", "click", function (c) {
            $(this).fadeOut(200, function () {
                iyuesai.ui.clearTimer();
                $(this).remove();
            });
        });
        if ($("body").attr("id") != "index") {
            $("#navigation").hover(function () {
                $(this).find("ul.navigation-list").addClass("hover");
            }, function () {
                $(this).find("ul.navigation-list").removeClass("hover");
            });
        } else {
            $("#navigation ul.navigation-list").addClass("hover");
        }
        $("#navigation li.navigation-item").hover(function () {
            $(this).addClass("hover");
        }, function () {
            $(this).removeClass("hover");
        });
        $("#site-navigation li.site-navigation-item").hover(function () {
            if ($(this).find("ul.menu-list").length > 0) {
                $(this).find("a.menu-root").addClass("hover").end().find("ul.menu-list").width($(this).width() - 7).slideDown(200);
            }
        }, function () {
            if ($(this).find("ul.menu-list").length > 0) {
                $(this).find("a.menu-root").removeClass("hover").end().find("ul.menu-list").stop(true, true).slideUp(200);
            }
        });
        $("h4#header-title").appendTo($("#header-body"));
        var a = $("<div>", {"class": "gotop-container"}), b = $("<a>", {href: "javascript:;", "class": "gotop"});
        a.append(b);
        a.appendTo($("body"));
        b.bind("click", function (c) {
            $("html,body").stop(true, true).animate({scrollTop: 0}, 200);
            $(this).blur();
            c.stopPropagation();
        });
        a.goToTop({
            onShow: function () {
                $(this).addClass("scrollfixed");
            }, onHide: function () {
                $(this).removeClass("scrollfixed");
            }, bottomTarget: $("#footer")
        });
        (function () {
            iyuesai.api.getUnreadMsg(function (m) {
                if (!!m) {
                    selector = function (d) {
                        return $('[data-selector="' + d + '"]');
                    };
                    var f = m.unreadMsgCount, h = m.tagMsgCount, n = m.systemMsgCount, j = m.activityMsgCount, e = m.systemMsgCount;
                    var k = selector("unreadMsgCount"), l = selector("tagMsgCount"), o = selector("gameMsgCount"), g = selector("activityMsgCount"), c = selector("systemMsgCount");
                    f > 0 && k.html(f).show() || k.html("").hide();
                    h > 0 && l.html(h).show() || l.html("").hide();
                    n > 0 && o.html(n).show() || o.html("").hide();
                    j > 0 && g.html(j).show() || g.html("").hide();
                    e > 0 && c.html(e).show() || c.html("").hide();
                }
            });
        })();
    });
});